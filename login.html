<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" type="image/png" href="favicon.png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login to JohnBlox</title>
    <style>
        /* Shared CSS from previous files */
        body { font-family: Verdana, Arial, sans-serif; background-color: #c9d4e4; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; color: #000; }
        .login-container { background-color: #fff; padding: 30px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); text-align: center; width: 350px; box-sizing: border-box; }
        .login-container h1 { color: #0074cc; margin-bottom: 25px; font-size: 24px; }
        .login-container input { width: calc(100% - 22px); padding: 12px; margin-bottom: 18px; border: 1px solid #a0a0a0; border-radius: 5px; font-size: 16px; box-sizing: border-box; }
        .login-container button { width: 100%; padding: 14px; background-color: #0066cc; color: white; border: none; border-radius: 5px; font-size: 18px; cursor: pointer; transition: background-color 0.2s; font-weight: bold; }
        .login-container button:hover { background-color: #004c99; }
        .message { margin-top: 15px; color: red; font-weight: bold; font-size: 14px; }
        .setup-link { margin-top: 20px; font-size: 14px; }
        .setup-link a { color: #0066cc; text-decoration: none; font-weight: bold; }
        .setup-link a:hover { text-decoration: underline; }
    </style>
    <!-- Parse SDK CDN -->
    <script src="https://npmcdn.com/parse/dist/parse.min.js"></script>
<script src="parse-config.js"></script>
</head>
<body>
    <div class="login-container">
        <h1>Login to JohnBlox</h1>
        <!-- Parse User Auth uses Username or Email -->
        <label for="username_or_email">Username or Email:</label>
        <input type="text" id="username_or_email" placeholder="Your username or email" required>

        <label for="password">Password:</label>
        <input type="password" id="password" placeholder="Your password" required>

        <button onclick="loginUser()">Login</button>
        <p id="message" class="message"></p>
        <p class="setup-link">Don't have an account? <a href="setup.html">Setup your account here</a></p> 
    </div>

    <script>
        // *** BACK4APP KEYS (Copied from your dashboard image) ***
        const APP_ID = 'UolRo1iE7vzgUI6J8OWGPrttMsCISDt4FrKtgfHWoCj';
        const JS_KEY = 'UpgDbqfWwBHyj8saGbCwWcCR5QU3ngG0zBb4Zbu8UHm';

        // Initialize Parse
        Parse.initialize(APP_ID, JS_KEY);
        Parse.serverURL = 'https://parseapi.back4app.com/'; 

        async function loginUser() {
            const usernameOrEmail = document.getElementById('username_or_email').value;
            const password = document.getElementById('password').value;
            const messageEl = document.getElementById('message');

            try {
                const user = await Parse.User.logIn(usernameOrEmail, password);
                
                // Store username (optional, for convenience in UI)
                localStorage.setItem('JohnBlox_username', user.get("username") || user.get("email"));
                
                messageEl.textContent = "Login successful! Redirecting...";
                messageEl.style.color = "green";
                setTimeout(() => { window.location.href = "index.html"; }, 2000); 

            } catch (error) {
                console.error("Login failed:", error.message);
                let errorMessage = error.message;
                if (error.code === 101) { // Error 101 is "Invalid username/password" in Parse
                    errorMessage = "Invalid username/email or password.";
                }
                messageEl.textContent = `Login failed: ${errorMessage}`;
                messageEl.style.color = "red";
            }
        }
    </script>
</body>
</html>
